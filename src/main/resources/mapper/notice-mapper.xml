<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.pcar.back.boards.notice.model.dao.NoticeMapper">

    <!-- 전체 조회 -->
    <select id="findAll"
            resultType="com.kh.pcar.back.boards.notice.model.dto.NoticeDTO">
        SELECT
               N.NOTICE_NO noticeNo
             , N.NOTICE_TITLE noticeTitle
             , M.USER_ID noticeWriter
             , N.NOTICE_DATE noticeDate
             , N.NOTICE_COUNT noticeCount
          FROM 
          	   TB_NOTICE N
          JOIN 
          	   TB_MEMBER M ON N.NOTICE_WRITER = M.USER_NO
         WHERE 
         	   N.NOTICE_STATUS = 'Y'
         ORDER 
            BY 
               N.NOTICE_NO DESC
    </select>
    
    <!-- 전체 개수 -->
    <select id="countNotices" resultType="long">
        SELECT 
        	   COUNT(*)
          FROM 
               TB_NOTICE N
         WHERE 
               N.NOTICE_STATUS = 'Y'
    </select>

    <!-- 조회수 증가 -->
    <update id="increaseCount">
        UPDATE 
        	   TB_NOTICE
           SET 
           	   NOTICE_COUNT = NOTICE_COUNT + 1
         WHERE 
         	   NOTICE_NO = #{noticeNo}
           AND 
               NOTICE_STATUS = 'Y'
    </update>

    <!-- 상세 조회 -->
    <select id="findById"
            parameterType="long"
            resultType="com.kh.pcar.back.boards.notice.model.dto.NoticeDTO">
        SELECT
               N.NOTICE_NO noticeNo
             , N.NOTICE_TITLE noticeTitle
             , M.USER_ID noticeWriter
             , N.NOTICE_CONTENT noticeContent
             , N.NOTICE_DATE noticeDate
             , N.NOTICE_COUNT noticeCount
          FROM 
          	   TB_NOTICE N
          JOIN 
          	   TB_MEMBER M ON N.NOTICE_WRITER = M.USER_NO
         WHERE 
         	   N.NOTICE_NO = #{noticeNo}
           AND 
           	   N.NOTICE_STATUS = 'Y'
    </select>
    
    <!-- 검색용 총 개수 -->
    <select id="countSearchNotices" parameterType="map" resultType="long">
	    SELECT COUNT(*)
	    FROM TB_NOTICE N
	    JOIN TB_MEMBER M ON N.NOTICE_WRITER = M.USER_NO
	    WHERE N.NOTICE_STATUS = 'Y'
	    <choose>
	        <when test="type == 'title'">
	            AND N.NOTICE_TITLE LIKE #{keyword}
	        </when>
	        <when test="type == 'writer'">
	            AND M.USER_ID LIKE #{keyword}
	        </when>
	        <when test="type == 'content'">
	            AND N.NOTICE_CONTENT LIKE #{keyword}
	        </when>
	        <otherwise>
	            AND (
	                N.NOTICE_TITLE   LIKE #{keyword}
	                OR M.USER_ID     LIKE #{keyword}
	                OR N.NOTICE_CONTENT LIKE #{keyword}
	            )
	        </otherwise>
	    </choose>
	</select>

    <!-- 검색 결과 목록 (페이징) -->
    <select id="searchNotices" parameterType="map"
	        resultType="com.kh.pcar.back.boards.notice.model.dto.NoticeDTO">
	    SELECT
	           N.NOTICE_NO noticeNo
	         , N.NOTICE_TITLE noticeTitle
	         , M.USER_ID noticeWriter
	         , N.NOTICE_CONTENT noticeContent
	         , N.NOTICE_DATE noticeDate
	         , N.NOTICE_COUNT noticeCount
	    FROM TB_NOTICE N
	    JOIN TB_MEMBER M ON N.NOTICE_WRITER = M.USER_NO
	    WHERE N.NOTICE_STATUS = 'Y'
	    <choose>
	        <when test="type == 'title'">
	            AND N.NOTICE_TITLE LIKE #{keyword}
	        </when>
	        <when test="type == 'writer'">
	            AND M.USER_ID LIKE #{keyword}
	        </when>
	        <when test="type == 'content'">
	            AND N.NOTICE_CONTENT LIKE #{keyword}
	        </when>
	        <otherwise>
	            AND (
	                N.NOTICE_TITLE      LIKE #{keyword}
	                OR M.USER_ID        LIKE #{keyword}
	                OR N.NOTICE_CONTENT LIKE #{keyword}
	            )
	        </otherwise>
	    </choose>
	    ORDER BY N.NOTICE_NO DESC
	    OFFSET #{offset} ROWS FETCH NEXT #{pageSize} ROWS ONLY
	</select>

</mapper>